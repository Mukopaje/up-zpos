<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-button slot="start" fill="clear" (click)="openMenu()">
      <ion-icon name="menu-outline"></ion-icon>
    </ion-button>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Business Information -->
  <ion-list>
    <ion-list-header>
      <ion-label>Business Information</ion-label>
    </ion-list-header>

    <ion-item button (click)="editBusinessInfo()">
      <ion-icon name="business-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Business Name</h2>
        <p>{{ printerSettings().businessInfo.name || 'Not set' }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="selectBusinessType()">
      <ion-icon name="storefront" slot="start"></ion-icon>
      <ion-label>
        <h2>Business Type</h2>
        <p>{{ getBusinessTypeLabel(appSettings().businessType) }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="selectPosMode()">
      <ion-icon name="cart-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Default POS Mode</h2>
        <p>{{ getPosModeName(appSettings().defaultPosMode) }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editField('address', 'Business Address', printerSettings().businessInfo.address)">
      <ion-icon name="location-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Address</h2>
        <p>{{ printerSettings().businessInfo.address || 'Not set' }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editField('phone', 'Phone Number', printerSettings().businessInfo.phone)">
      <ion-icon name="call-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Phone</h2>
        <p>{{ printerSettings().businessInfo.phone || 'Not set' }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editField('email', 'Email Address', printerSettings().businessInfo.email)">
      <ion-icon name="mail-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Email</h2>
        <p>{{ printerSettings().businessInfo.email || 'Not set' }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editField('taxNumber', 'Tax Number (TPIN)', printerSettings().businessInfo.taxNumber)">
      <ion-icon name="document-text-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Tax Number (TPIN)</h2>
        <p>{{ printerSettings().businessInfo.taxNumber || 'Not set' }}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- POS Settings -->
  <ion-list>
    <ion-list-header>
      <ion-label>POS Appearance</ion-label>
    </ion-list-header>

    <ion-item button (click)="editCategoryTileColor()">
      <ion-icon name="color-palette-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Category Tile Color</h2>
        <p>Customize category tile background</p>
      </ion-label>
      <div slot="end" class="color-preview" [style.background-color]="settingsService.settings().categoryTileBackgroundColor"></div>
    </ion-item>

    <ion-item button (click)="editProductTileColor()">
      <ion-icon name="color-palette-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Product Tile Color</h2>
        <p>Customize product tile background</p>
      </ion-label>
      <div slot="end" class="color-preview" [style.background-color]="settingsService.settings().productTileBackgroundColor"></div>
    </ion-item>
  </ion-list>

  <!-- Tax Settings -->
  <ion-list>
    <ion-list-header>
      <ion-label>Tax Configuration</ion-label>
    </ion-list-header>

    <ion-item>
      <ion-icon name="calculator-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Enable Tax</h2>
        <p>Calculate tax on sales</p>
      </ion-label>
      <ion-toggle [(ngModel)]="tempSettings.taxEnabled" (ionChange)="saveSettings()"></ion-toggle>
    </ion-item>

    <ion-item button (click)="editTaxRate()">
      <ion-icon name="calculator-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Tax Rate</h2>
        <p>{{ tempSettings.taxRate }}%</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="selectTaxMode()">
      <ion-icon name="cash-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Tax Mode</h2>
        <p>{{ tempSettings.taxMode === 'inclusive' ? 'Tax Inclusive (Included in price)' : 'Tax Exclusive (Added at checkout)' }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editTaxName()">
      <ion-icon name="pricetag-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Tax Label</h2>
        <p>{{ tempSettings.taxName || 'VAT' }}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Loyalty & Promotions -->
  <ion-list>
    <ion-list-header>
      <ion-label>Loyalty &amp; Promotions</ion-label>
    </ion-list-header>

    <ion-item button (click)="editLoyaltyProgram()">
      <ion-icon name="cash-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Loyalty Program</h2>
        <p>{{ getLoyaltySummary() }}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Receipt Settings -->
  <ion-list>
    <ion-list-header>
      <ion-label>Receipt Settings</ion-label>
    </ion-list-header>

    <ion-item>
      <ion-icon name="print-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Auto Print</h2>
        <p>Automatically print receipt after payment</p>
      </ion-label>
      <ion-toggle [(ngModel)]="tempSettings.autoPrint" (ionChange)="saveSettings()"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-icon name="chatbox-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Show Receipt Options</h2>
        <p>Show WhatsApp/Email options after payment</p>
      </ion-label>
      <ion-toggle [(ngModel)]="tempSettings.showReceiptOptions" (ionChange)="saveSettings()"></ion-toggle>
    </ion-item>

    <ion-item button (click)="editNumber('printCopies', 'Number of Copies', printerSettings().printCopies)">
      <ion-icon name="copy-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Print Copies</h2>
        <p>{{ printerSettings().printCopies }} {{ printerSettings().printCopies === 1 ? 'copy' : 'copies' }}</p>
      </ion-label>
    </ion-item>

    <ion-item>
      <ion-icon name="cut-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Auto Cut Paper</h2>
        <p>Automatically cut paper after printing</p>
      </ion-label>
      <ion-toggle [(ngModel)]="tempSettings.autoCut" (ionChange)="saveSettings()"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-icon name="cash-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Open Cash Drawer</h2>
        <p>Open cash drawer after printing</p>
      </ion-label>
      <ion-toggle [(ngModel)]="tempSettings.openCashDrawer" (ionChange)="saveSettings()"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-icon name="image-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Print Logo</h2>
        <p>Include business logo on receipts</p>
      </ion-label>
      <ion-toggle [(ngModel)]="tempSettings.printLogo" (ionChange)="saveSettings()"></ion-toggle>
    </ion-item>

    <ion-item button (click)="selectFontSize()">
      <ion-icon name="text-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Font Size</h2>
        <p>{{ printerSettings().fontSize | titlecase }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="selectPaperWidth()">
      <ion-icon name="resize-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Paper Width</h2>
        <p>{{ printerSettings().paperWidth }}mm</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editField('receiptFooter', 'Receipt Footer', printerSettings().businessInfo.footer, true)">
      <ion-icon name="chatbox-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Receipt Footer</h2>
        <p>{{ printerSettings().businessInfo.footer || 'Not set' }}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- System Settings -->
  <ion-list>
    <ion-list-header>
      <ion-label>System Settings</ion-label>
    </ion-list-header>

    <ion-item button routerLink="/printer-settings">
      <ion-icon name="print-outline" slot="start" color="primary"></ion-icon>
      <ion-label>
        <h2>Printer Settings</h2>
        <p>Configure Bluetooth printer</p>
      </ion-label>
      <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
    </ion-item>

    <ion-item button (click)="editField('currency', 'Currency', tempSettings.currency)">
      <ion-icon name="cash-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Currency</h2>
        <p>{{ tempSettings.currency }}</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="editNumber('taxRate', 'Tax Rate (%)', tempSettings.taxRate)">
      <ion-icon name="calculator-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Tax Rate</h2>
        <p>{{ tempSettings.taxRate }}%</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Data Management -->
  <ion-list>
    <ion-list-header>
      <ion-label>Data Management</ion-label>
    </ion-list-header>

    <ion-item button (click)="exportData()">
      <ion-icon name="download-outline" slot="start" color="primary"></ion-icon>
      <ion-label>
        <h2>Export Data</h2>
        <p>Download database backup</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="clearCache()">
      <ion-icon name="trash-outline" slot="start" color="warning"></ion-icon>
      <ion-label>
        <h2>Clear Cache</h2>
        <p>Free up storage space</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="resetSettings()">
      <ion-icon name="refresh-outline" slot="start" color="danger"></ion-icon>
      <ion-label>
        <h2>Reset Settings</h2>
        <p>Restore default settings</p>
      </ion-label>
    </ion-item>

    <ion-item button (click)="resetCatalog()">
      <ion-icon name="trash-outline" slot="start" color="danger"></ion-icon>
      <ion-label>
        <h2>Reset Product Catalog</h2>
        <p>Delete all products and categories on this device</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- App Information -->
  <ion-list>
    <ion-list-header>
      <ion-label>App Information</ion-label>
    </ion-list-header>

    <ion-item>
      <ion-icon name="information-circle-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Version</h2>
        <p>1.0.0</p>
      </ion-label>
    </ion-item>

    <ion-item>
      <ion-icon name="code-outline" slot="start"></ion-icon>
      <ion-label>
        <h2>Build</h2>
        <p>Ionic 8 / Angular 17</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <div class="footer-padding"></div>
</ion-content>
