<ion-header>
  <ion-toolbar color="primary">
    <ion-title>ZRA Compliance</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refresh()">
        <ion-icon slot="icon-only" name="sync-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="zra-dashboard">
  <ion-refresher slot="fixed" (ionRefresh)="refresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="dashboard-header">
    <div class="status-indicator" [class.success]="isCompliant()">
      <ion-icon [name]="isCompliant() ? 'shield-checkmark-outline' : 'alert-circle-outline'"></ion-icon>
      <div class="status-text">
        <h2>{{ isCompliant() ? 'COMPLIANT' : 'SYNC PENDING' }}</h2>
        <p>{{ isCompliant() ? 'All invoices are signed by ZRA' : 'Some invoices are waiting for internet' }}</p>
      </div>
    </div>
  </div>

  <ion-grid>
    <ion-row>
      <ion-col size="6">
        <ion-card class="metric-card">
          <ion-card-content>
            <ion-note>Total Sales (Today)</ion-note>
            <h3>K{{ totalSalesToday().toFixed(2) }}</h3>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size="6">
        <ion-card class="metric-card">
          <ion-card-content>
            <ion-note>Tax Collected</ion-note>
            <h3 color="success">K{{ taxCollectedToday().toFixed(2) }}</h3>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-card class="queue-card">
    <ion-card-content>
      <div class="card-header-row">
        <span>Offline Sync Progress</span>
        <ion-badge color="primary">{{ (syncProgress() * 100).toFixed(0) }}%</ion-badge>
      </div>
      <ion-progress-bar [value]="syncProgress()"></ion-progress-bar>
      <ion-note>{{ pendingFiscalization() }} invoices waiting in local queue</ion-note>
    </ion-card-content>
  </ion-card>

  <div class="section-title">
    <ion-label>Recent Fiscal Activity</ion-label>
    <ion-button fill="clear" size="small" (click)="exportReport()">
      <ion-icon slot="start" name="download-outline"></ion-icon>
      Export Report
    </ion-button>
  </div>

  <ion-list lines="full" class="activity-list">
    @for (invoice of recentInvoices(); track invoice.fdn) {
      <ion-item>
        <ion-icon slot="start" name="receipt-outline" color="primary"></ion-icon>
        <ion-label>
          <h3>{{ invoice.fdn }}</h3>
          <p><ion-icon name="time-outline"></ion-icon> {{ invoice.time }}</p>
        </ion-label>
        <div slot="end" class="amount-side">
          <ion-text [color]="invoice.status === 'fiscalized' ? 'success' : 'warning'">
            <strong>K{{ invoice.amount.toFixed(2) }}</strong>
          </ion-text>
          <ion-badge [color]="invoice.status === 'fiscalized' ? 'success' : 'warning'">
            {{ invoice.status }}
          </ion-badge>
        </div>
      </ion-item>
    }
  </ion-list>
</ion-content>
